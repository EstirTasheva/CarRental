@using CarRental.Models.ViewModels
@using CarRental.Helpers
@using CarRental.Enums;
@model RentalsIndexViewModel

@{
	ViewData["Title"] = "Договори за наем";
}

<h2 class="pink-title mb-3">Договори за наем</h2>

<form asp-controller="RentalContracts" asp-action="Index" method="get" class="card card-body filter-card mb-3">
	<div class="row g-3 align-items-center">
		<div class="col-md-4">
			<label class="form-label pink-label">Клиент</label>
			<input type="text" name="client" value="@Model.Client" class="form-control pink-input" placeholder="Име или имейл на клиента" />
		</div>
		<div class="col-md-4">
			<label class="form-label pink-label">Автомобил</label>
			<input type="text" name="car" value="@Model.Car" class="form-control pink-input" placeholder="Марка/модел/рег. №" />
		</div>
		<div class="col-md-4">
			<label class="form-label pink-label">Статус на договора</label>
			<select name="status" class="form-select pink-input">
				<option value="">--Всички--</option>
				@foreach (var status in Model.Statuses)
				{
					bool isSelected = (Model.Status?.ToString() == status.Value.ToString());
					<option value="@status.Value" selected="@isSelected">
						@status.Text
					</option>
				}
			</select>
		</div>
		<div class="col-md-2">
			<label class="form-label pink-label">От дата</label>
			<input type="date" name="fromDate" value="@Model.FromDate" class="form-control pink-input" />
		</div>
		<div class="col-md-2">
			<label class="form-label pink-label">До дата</label>
			<input type="date" name="toDate" value="@Model.ToDate" class="form-control pink-input" />
		</div>
		<div class="col-md-2 d-grid mt-5">
			<button type="submit" class="btn btn-softpink">Търси</button>
		</div>
		<div class="col-md-2 d-grid mt-5">
			<a asp-controller="RentalContracts" asp-action="Index" class="btn btn-outline-secondary">
				Изчисти
			</a>
		</div>
	</div>
</form>

@if (!Model.Rentals.Any())
{
	<div class="alert alert-info">
		Няма налични договори за наем.
	</div>
}
else
{
	<div class="table-respnsive">
		<table class="table table-striped table-hover align-middle">
			<thead>
				<tr>
					<th>#</th>
					<th>Автомобил</th>
					<th>Клиент</th>
					<th>Период</th>
					<th>Обща цена</th>
					<th>Статус на договора</th>
					<th class="text-end">Действия</th>
				</tr>
			</thead>
			<tbody>
				@foreach (var rental in Model.Rentals)
				{
					bool isActive = rental.Status == RentalContractStatus.Active;
					<tr>
						<td>@rental.Id</td>
						<td>
							@rental.Car.Brand @rental.Car.Model
							<div class="text-muted small">Рег. № @rental.Car.RegistrationNumber</div>
						</td>
						<td>
							@rental.Client.FirstName @rental.Client.LastName
							<div class="text-muted small">Email: @rental.Client.Email</div>
						</td>
						<td>@rental.StartDate.ToString("dd.MM.yyyy") - @rental.EndDate.ToString("dd.MM.yyyy")</td>
						<td>@rental.TotalPrice.ToString("0.00") €</td>
						<td>
							@if (rental.Status == RentalContractStatus.Active)
							{
								<span class="badge bg-success">Активен</span>
							}
							else if (rental.Status == RentalContractStatus.Canceled)
							{
								<span class="badge bg-danger">Анулиран</span>
							}
							else if (rental.Status == RentalContractStatus.Finished)
							{
								<span class="badge bg-warning text-dark">Завършен</span>
							}
						</td>
						<td>
							<div class="d-flex justify-content-end gap-2">
								<a asp-controller="RentalContracts" asp-action="Details" asp-route-id="@rental.Id" class="btn btn-baby-blue">Детайли</a>
								@if (isActive)
								{
									<form asp-controller="RentalContracts" asp-action="Finish" method="post" class="d-inline">
										<input type="hidden" name="id" value="@rental.Id" />
										<button type="submit" class="btn btn-baby-green">
											Завърши
										</button>
									</form>
									<form asp-controller="RentalContracts" asp-action="Cancel" method="post" class="d-inline">
										<input type="hidden" name="id" value="@rental.Id" />
										<button type="submit" class="btn btn-baby-red">
											Анулирай
										</button>
									</form>
								}
							</div>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
}
